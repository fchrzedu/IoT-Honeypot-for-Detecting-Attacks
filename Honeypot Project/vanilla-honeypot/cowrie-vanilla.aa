# Last Modified: Wed Feb 18 21:40:26 2026

# ============================================================
# APPARMOR PROFILE: cowrie-vanilla
# ============================================================

# 			PURPOSE:
#   Confines the vanilla Cowrie SSH honeypot process.
#   Built using aa-genprof/aa-logprof in complain mode,
#   Observing real Cowrie runtime behaviour.


# 			INSTRUCTIONS:
# Copy to /etc/apparmor.d/, and ensure its named 'cowrie-vanilla', not 'cowrie-vanilla.aa'
# Load it into kernel: sudo apparmor_parser -r /etc/apparmor.d/cowrie-vanilla
# To launch this profile against Cowrie, you need this specific executable:
# aa-exec -p cowrie-vanilla -- \
#        <path-to>/cowrie-env/bin/python \
#        <path-to>/cowrie-env/bin/twistd \
#        --umask=0022 \
#        --pidfile <path-to>/var/run/cowrie.pid \
#        --logger cowrie.python.logfile.logger \
#        cowrie

#			NOTE:
# This profile (by default) runs in complain mode. Enforce it via aa-enforce 
# - Franek :)

include <tunables/global>

profile cowrie-vanilla flags=(complain) {
  include <abstractions/base>
  include <abstractions/nameservice>
  include <abstractions/python>

  capability dac_read_search,

  network inet tcp,
  network inet udp,
  network inet6 tcp,
  network netlink raw,

  "/home/*/IoT-Honeypot-for-Detecting-Attacks/Honeypot Project/vanilla-honeypot/cowrie/**" r,
  "/home/*/IoT-Honeypot-for-Detecting-Attacks/Honeypot Project/vanilla-honeypot/cowrie/cowrie-env/lib/python3.12/site-packages/_cffi_backend.cpython-312-x86_64-linux-gnu.so" mrw,
  "/home/*/IoT-Honeypot-for-Detecting-Attacks/Honeypot Project/vanilla-honeypot/cowrie/cowrie-env/lib/python3.12/site-packages/bcrypt/_bcrypt.abi3.so" mrw,
  "/home/*/IoT-Honeypot-for-Detecting-Attacks/Honeypot Project/vanilla-honeypot/cowrie/cowrie-env/lib/python3.12/site-packages/charset_normalizer/md.cpython-312-x86_64-linux-gnu.so" mrw,
  "/home/*/IoT-Honeypot-for-Detecting-Attacks/Honeypot Project/vanilla-honeypot/cowrie/cowrie-env/lib/python3.12/site-packages/charset_normalizer/md__mypyc.cpython-312-x86_64-linux-gnu.so" mrw,
  "/home/*/IoT-Honeypot-for-Detecting-Attacks/Honeypot Project/vanilla-honeypot/cowrie/cowrie-env/lib/python3.12/site-packages/cryptography/hazmat/bindings/_rust.abi3.so" mrw,
  "/home/*/IoT-Honeypot-for-Detecting-Attacks/Honeypot Project/vanilla-honeypot/cowrie/cowrie-env/lib/python3.12/site-packages/zope/interface/_zope_interface_coptimizations.cpython-312-x86_64-linux-gnu.so" mrw,
  "/home/*/IoT-Honeypot-for-Detecting-Attacks/Honeypot Project/vanilla-honeypot/cowrie/var/**" rw,
  /etc/** r,
  /lib/** rix,
  /proc/** r,
  / r,
  /run/** rw,
  /sys/fs/cgroup/user.slice/cpu.max r,
  /sys/fs/cgroup/user.slice/user-1000.slice/cpu.max r,
  /sys/fs/cgroup/user.slice/user-1000.slice/session-3.scope/cpu.max r,
  /tmp/** rw,
  /usr/** rix,
  owner "/home/*/IoT-Honeypot-for-Detecting-Attacks/Honeypot Project/vanilla-honeypot/cowrie/" r,

}
